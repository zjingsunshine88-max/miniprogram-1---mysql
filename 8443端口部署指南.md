# 8443端口部署指南

## 问题描述
当前使用443端口的HTTPS服务在外网无法访问，但在本机可以正常访问。需要切换到8443端口进行测试。

## 解决方案

### 1. 环境配置已更新
- ✅ `admin/env.production` 已修改为8443端口
- ✅ 服务器地址: `https://practice.insightdata.top:8443`

### 2. 部署步骤

#### 步骤1: 更新nginx配置
```bash
# 运行nginx配置更新脚本
更新nginx配置8443.bat
```

#### 步骤2: 重新部署admin
```bash
# 运行一键部署脚本
一键重新部署admin.bat
```

#### 步骤3: 测试连接
```bash
# 运行端口测试脚本
测试8443端口.bat
```

### 3. 脚本说明

#### 一键重新部署admin.bat
- 自动构建admin项目
- 复制dist文件到 `C:\admin\dist`
- 重启nginx服务
- 测试服务状态

#### 更新nginx配置8443.bat
- 备份原配置文件
- 应用新的8443端口配置
- 测试nginx配置
- 重启nginx服务

#### 测试8443端口.bat
- 测试本地8443端口连接
- 测试外网8443端口连接
- 测试API接口连接
- 检查防火墙状态

### 4. 重要配置检查

#### 防火墙设置
```bash
# Windows防火墙添加8443端口规则
netsh advfirewall firewall add rule name="8443" dir=in action=allow protocol=TCP localport=8443
```

#### 云服务器安全组
- 入方向规则: 端口8443, 协议TCP, 源0.0.0.0/0

#### SSL证书路径
- 证书文件: `C:/certificates/practice.insightdata.top.pem`
- 私钥文件: `C:/certificates/practice.insightdata.top.key`

### 5. 访问地址
- 管理后台: `https://practice.insightdata.top:8443`
- API接口: `https://practice.insightdata.top:8443/api/`
- 健康检查: `https://practice.insightdata.top:8443/health`

### 6. 故障排除

#### 如果外网仍无法访问:
1. 检查云服务器安全组是否开放8443端口
2. 检查Windows防火墙设置
3. 确认SSL证书文件存在且有效
4. 检查nginx错误日志: `C:\nginx\logs\practice.insightdata.top.error.log`

#### 如果API无法访问:
1. 确认后端服务运行在3002端口
2. 检查API服务日志
3. 测试本地API连接: `http://localhost:3002/api/health`

### 7. 回滚方案
如果需要回滚到443端口:
1. 恢复原nginx配置文件
2. 修改 `admin/env.production` 中的端口号
3. 重新部署admin项目

## 注意事项
- 8443端口是非标准HTTPS端口，某些网络环境可能会被阻止
- 建议在生产环境中使用标准443端口
- 确保SSL证书对8443端口有效
