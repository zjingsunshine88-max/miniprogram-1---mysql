# ç®¡ç†å‘˜è®¤è¯é—®é¢˜è§£å†³æŒ‡å—

## ğŸš¨ é—®é¢˜æè¿°

åå°ç®¡ç†ç³»ç»Ÿå‡ºç°401 Unauthorizedé”™è¯¯ï¼Œæç¤º"tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ"ã€‚

## ğŸ” é—®é¢˜åŸå› 

1. **æœªç™»å½•**: åå°ç®¡ç†ç³»ç»Ÿéœ€è¦ç®¡ç†å‘˜ç™»å½•è®¤è¯
2. **Tokenè¿‡æœŸ**: ç™»å½•tokenå·²è¿‡æœŸ
3. **ç®¡ç†å‘˜ç”¨æˆ·ä¸å­˜åœ¨**: æ•°æ®åº“ä¸­æœªåˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
4. **æ•°æ®åº“è¿æ¥é—®é¢˜**: æ— æ³•è¿æ¥åˆ°æ•°æ®åº“

## ğŸš€ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šä¸€é”®ä¿®å¤ï¼ˆæ¨èï¼‰

```batch
# è¿è¡Œä¸€é”®ä¿®å¤è„šæœ¬
fix-admin-auth.bat
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- æ£€æŸ¥æ•°æ®åº“è¿æ¥
- åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
- æä¾›ç™»å½•ä¿¡æ¯
- åˆ›å»ºæµ‹è¯•è„šæœ¬

### æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨ä¿®å¤

#### 1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
```batch
# æµ‹è¯•æ•°æ®åº“è¿æ¥
test-db-connection.bat
```

#### 2. åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
```batch
# è¿›å…¥serverç›®å½•
cd server

# è®¾ç½®å¼€å‘ç¯å¢ƒå˜é‡
set NODE_ENV=development
set DB_PASSWORD=1234

# è¿è¡Œç®¡ç†å‘˜åˆå§‹åŒ–è„šæœ¬
node scripts/init-admin.js
```

#### 3. å¯åŠ¨æœåŠ¡
```batch
# å¯åŠ¨APIæœåŠ¡
start-server-dev.bat

# å¯åŠ¨åå°ç®¡ç†
start-admin.bat
```

### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨å¿«é€Ÿç™»å½•

```batch
# æŸ¥çœ‹ç®¡ç†å‘˜ç™»å½•ä¿¡æ¯
admin-quick-login.bat
```

## ğŸ”‘ ç®¡ç†å‘˜ç™»å½•ä¿¡æ¯

### é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·
- **æ‰‹æœºå·**: `13800138000`
- **æ˜µç§°**: `ç³»ç»Ÿç®¡ç†å‘˜`
- **å¯†ç **: (æ— å¯†ç ï¼Œç›´æ¥ç™»å½•)

### ç™»å½•æ­¥éª¤
1. è®¿é—®åå°ç®¡ç†: http://localhost:3001
2. è¾“å…¥æ‰‹æœºå·: `13800138000`
3. å¯†ç ç•™ç©ºæˆ–è¾“å…¥ä»»æ„å­—ç¬¦
4. ç‚¹å‡»ç™»å½•

## ğŸ§ª æµ‹è¯•è®¤è¯

### æµ‹è¯•ç®¡ç†å‘˜ç™»å½•
```batch
# è¿è¡Œç™»å½•æµ‹è¯•è„šæœ¬
node test-admin-login.js
```

### æ‰‹åŠ¨æµ‹è¯•API
```javascript
// ä½¿ç”¨curlæµ‹è¯•
curl -X POST http://localhost:3002/api/user/admin-login \
  -H "Content-Type: application/json" \
  -d '{"phoneNumber":"13800138000","password":""}'
```

## ğŸ”§ æ•…éšœæ’é™¤

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
```batch
# æ£€æŸ¥MySQLæœåŠ¡
net start mysql

# æµ‹è¯•è¿æ¥
mysql -u root -p1234 -e "SELECT 1;"
```

### 2. ç®¡ç†å‘˜ç”¨æˆ·åˆ›å»ºå¤±è´¥
```batch
# æ‰‹åŠ¨åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
cd server
node -e "
const { User } = require('./models');
const { sequelize } = require('./config/database');

(async () => {
  try {
    await sequelize.authenticate();
    const admin = await User.create({
      phoneNumber: '13800138000',
      nickName: 'ç³»ç»Ÿç®¡ç†å‘˜',
      isAdmin: true
    });
    console.log('ç®¡ç†å‘˜åˆ›å»ºæˆåŠŸ:', admin.id);
  } catch (error) {
    console.error('åˆ›å»ºå¤±è´¥:', error.message);
  }
  process.exit(0);
})();
"
```

### 3. TokenéªŒè¯å¤±è´¥
```batch
# æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒlocalStorage
# é‡æ–°ç™»å½•è·å–æ–°token
```

### 4. APIè°ƒç”¨å¤±è´¥
```batch
# æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨
netstat -an | findstr :3002

# é‡å¯æœåŠ¡å™¨
start-server-dev.bat
```

## ğŸ“‹ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1: "Access denied for user 'root'@'localhost'"
**è§£å†³æ–¹æ¡ˆ**: è¿è¡Œ `fix-mysql-connection.bat`

### é”™è¯¯2: "Cannot find module 'sequelize'"
**è§£å†³æ–¹æ¡ˆ**: 
```batch
cd server
npm install
```

### é”™è¯¯3: "Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ"
**è§£å†³æ–¹æ¡ˆ**: 
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
2. é‡æ–°ç™»å½•
3. æ£€æŸ¥tokenæ ¼å¼

### é”™è¯¯4: "401 Unauthorized"
**è§£å†³æ–¹æ¡ˆ**: 
1. ç¡®ä¿å·²ç™»å½•
2. æ£€æŸ¥tokenæ˜¯å¦æœ‰æ•ˆ
3. é‡æ–°è·å–token

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å®šæœŸå¤‡ä»½**: å¤‡ä»½ç®¡ç†å‘˜ç”¨æˆ·æ•°æ®
2. **å¯†ç ç®¡ç†**: ä¸ºç®¡ç†å‘˜è®¾ç½®å¼ºå¯†ç 
3. **Tokenç®¡ç†**: å®šæœŸæ›´æ–°token
4. **ç›‘æ§æ—¥å¿—**: ç›‘æ§è®¤è¯ç›¸å…³æ—¥å¿—
5. **æƒé™æ§åˆ¶**: ä¸¥æ ¼æ§åˆ¶ç®¡ç†å‘˜æƒé™

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼š

1. è¿è¡Œ `fix-admin-auth.bat` è¿›è¡Œå®Œæ•´è¯Šæ–­
2. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
3. éªŒè¯æ•°æ®åº“è¿æ¥
4. ç¡®è®¤ç®¡ç†å‘˜ç”¨æˆ·å­˜åœ¨
5. æµ‹è¯•APIç«¯ç‚¹

## ğŸ”„ ç»´æŠ¤å‘½ä»¤

```batch
# é‡æ–°åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
node server/scripts/init-admin.js

# æµ‹è¯•è®¤è¯æµç¨‹
node test-admin-login.js

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
netstat -an | findstr :3002

# é‡å¯æ‰€æœ‰æœåŠ¡
start-server-dev.bat
start-admin.bat
```
